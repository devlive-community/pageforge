<%
function isPathMatch(currentPath, targetPath) {
    const normalizedCurrent = currentPath.replace(/\.(md|html)$/, '');
    const normalizedTarget = targetPath.replace(/\.(md|html)$/, '');

    if (normalizedTarget === '/') {
        return normalizedCurrent === '/' || normalizedCurrent === '/index';
    }

    return normalizedCurrent === normalizedTarget;
}

function processLink(link) {
    if (link.endsWith('.html')) {
        return link;
    }

    if (link === '/') {
        return '/index.html';
    }

    const cleanLink = link.replace(/\.md$/, '');
    return `${cleanLink}.html`;
}

function isActive(link) {
    return isPathMatch(page.path, link);
}
%>

<header>
    <nav class="fixed top-0 w-full bg-white dark:bg-gray-800 border-b z-10">
        <div class="max-w-screen-xl px-4 mx-auto 2xl:px-0">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-8">
                    <div class="flex items-center space-x-4 shrink-0">
                        <% if (site.logo) { %>
                            <a href="/" class="flex items-center">
                                <img src="<%= basePath %>/<%= site.logo || 'assets/logo.svg' %>"
                                     alt="<%= site.title %>"
                                     class="h-10 w-auto object-contain transition-transform hover:scale-105">
                            </a>
                        <% } %>
                        <a href="/" class="text-xl font-bold text-gray-900 dark:text-white hover:text-gray-700 dark:hover:text-gray-200 transition-colors">
                            <%= site.title %>
                        </a>
                    </div>

                    <ul class="hidden lg:flex items-center justify-start gap-6 md:gap-8 py-3 sm:justify-center">
                        <% nav.forEach(function(item) { %>
                            <li class="shrink-0">
                                <a href="<%= processLink(item.link) %>"
                                   class="inline-flex items-center rounded-lg justify-center px-4 py-3
                                          <%= isActive(item.link) ? 'text-blue-600 dark:text-blue-400 bg-blue-50/80 dark:bg-blue-900/20 font-medium' : 'hover:text-gray-900 dark:hover:text-gray-200 hover:bg-gray-50 dark:hover:bg-gray-800/40' %>
                                          text-sm font-medium leading-none dark:text-white">
                                    <%= item.text %>
                                </a>
                            </li>
                        <% }); %>
                    </ul>
                </div>

                <!-- 仓库链接 -->
                <% if (repo) { %>
                    <div class="hidden lg:flex items-center space-x-4 text-sm" id="github-stats">
                        <a href="<%= repo.url %>"
                           target="_blank"
                           rel="noopener noreferrer"
                           class="inline-flex items-center gap-3 text-gray-600 hover:text-gray-500 transition-colors">
                            <div class="inline-flex items-center">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" class="w-6 h-6">
                                    <path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"></path>
                                </svg>
                            </div>
                            <div class="inline-flex flex-col items-center gap-0.5">
                                <div class="inline-flex items-center gap-1">
                                    <%= repo.owner %>/<%= repo.name %>
                                </div>
                                <div class="space-x-2" id="repo-stats">
                                    <!-- 初始显示配置的值 -->
                                    <div class="inline-flex items-center gap-1 tag-container">
                                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" width="16" height="16" fill="currentColor">
                                            <path d="M1 7.775V2.75C1 1.784 1.784 1 2.75 1h5.025c.464 0 .91.184 1.238.513l6.25 6.25a1.75 1.75 0 0 1 0 2.474l-5.026 5.026a1.75 1.75 0 0 1-2.474 0l-6.25-6.25A1.75 1.75 0 0 1 1 7.775Zm1.5 0c0 .066.026.13.073.177l6.25 6.25a.25.25 0 0 0 .354 0l5.025-5.025a.25.25 0 0 0 0-.354l-6.25-6.25a.25.25 0 0 0-.177-.073H2.75a.25.25 0 0 0-.25.25ZM6 5a1 1 0 1 1 0 2 1 1 0 0 1 0-2Z"></path>
                                        </svg>
                                        <%= repo.tag %>
                                    </div>
                                    <div class="inline-flex items-center gap-1 stars-container">
                                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" width="16" height="16" fill="currentColor">
                                            <path d="M8 .25a.75.75 0 0 1 .673.418l1.882 3.815 4.21.612a.75.75 0 0 1 .416 1.279l-3.046 2.97.719 4.192a.751.751 0 0 1-1.088.791L8 12.347l-3.766 1.98a.75.75 0 0 1-1.088-.79l.72-4.194L.818 6.374a.75.75 0 0 1 .416-1.28l4.21-.611L7.327.668A.75.75 0 0 1 8 .25Z"/>
                                        </svg>
                                        <%= repo.stars %>
                                    </div>
                                    <div class="inline-flex items-center gap-1 forks-container">
                                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" width="16" height="16" fill="currentColor">
                                            <path d="M5 5.372v.878c0 .414.336.75.75.75h4.5a.75.75 0 0 0 .75-.75v-.878a2.25 2.25 0 1 1 1.5 0v.878a2.25 2.25 0 0 1-2.25 2.25h-1.5v2.128a2.251 2.251 0 1 1-1.5 0V8.5h-1.5A2.25 2.25 0 0 1 3.5 6.25v-.878a2.25 2.25 0 1 1 1.5 0ZM5 3.25a.75.75 0 1 0-1.5 0 .75.75 0 0 0 1.5 0Zm6.75.75a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5Zm-3 8.75a.75.75 0 1 0-1.5 0 .75.75 0 0 0 1.5 0Z"/>
                                        </svg>
                                        <%= repo.forks %>
                                    </div>
                                </div>
                            </div>
                        </a>
                    </div>

                    <script>
                        // 初始化 GitHub Stats
                        document.addEventListener('DOMContentLoaded', function () {
                            if (window.PageForge && window.PageForge.GitHubStats) {
                                window.PageForge.GitHubStats.init('<%= repo.owner %>', '<%= repo.name %>');
                            }
                        });
                    </script>
                <% } %>
            </div>
        </div>
    </nav>
</header>